<!DOCTYPE html>
<html lang="en">
  <head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>View Post</title>
    <link rel="stylesheet" href="view.css" />
  </head>
  <body>
    <main>
      <div class="content">
        <img id="post-image" src="" alt="ì´ë¯¸ì§€ ì„¤ëª…" />
        <!-- ì´ë¯¸ì§€ srcë¥¼ ë™ì ìœ¼ë¡œ ì„¤ì • -->
        <div class="description">
          <p id="post-location">ìœ„ì¹˜:</p>
          <!-- ìœ„ì¹˜ë¥¼ ë™ì ìœ¼ë¡œ ì„¤ì • -->
          <h3 id="post-title">ì œëª©:</h3>
          <!-- ì œëª©ì„ ë™ì ìœ¼ë¡œ ì„¤ì • -->
          <p id="post-content"></p>
          <!-- ë‚´ìš©ì„ ë™ì ìœ¼ë¡œ ì„¤ì • -->
          <p id="post-createdAt">ì‘ì„± ì¼ì:</p>
          <!-- ì‘ì„±ì¼ì ì„¤ì • -->
          <p id="post-rating">í‰ì :</p>
          <!-- í‰ì ì„ ë™ì ìœ¼ë¡œ ì„¤ì • -->
        </div>
      </div>
    </main>

    <aside>
      <button class="sidebar-button" id="editButton">ìˆ˜ì •</button>
      <button class="sidebar-button" id="deleteButton">ì‚­ì œ</button>
    </aside>

    <!-- ì‚­ì œ í™•ì¸ ëª¨ë‹¬ -->
    <div class="modal" id="deleteModal">
      <div class="modal-content">
        <span class="close" onclick="closeModal('deleteModal')">&times;</span>
        <p>ì´ ê¸€ì„ ì™„ì „íˆ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?</p>
        <button id="confirmDeleteButton">ì‚­ì œ</button>
        <button id="cancelButton" onclick="closeModal('deleteModal')">
          ì·¨ì†Œ
        </button>
      </div>
    </div>

    <!-- js -->
    <script>
      document.addEventListener("DOMContentLoaded", () => {
        const postId = new URLSearchParams(window.location.search).get("id");

        if (postId) {
        fetch(`/api/posts/${postId}`)
            .then((res) => res.json())
            .then((post) => {
                document.getElementById("post-title").textContent = `ì œëª©: ${post.title}`;
                document.getElementById("post-content").textContent = `${post.content}`;
                document.getElementById("post-location").textContent = `ğŸ“ìœ„ì¹˜: ${post.country} , ${post.region}`;
                document.getElementById("post-rating").textContent = `ğŸ‘í‰ì : ${post.rating}`;
                document.getElementById("post-createdAt").textContent = `ì‘ì„± ì¼ì: ${new Date(post.createdAt).toLocaleString()}`;
                if (post.image) {
                    document.getElementById("post-image").src = `/uploads/${post.image}`;
                    document.getElementById("post-image").alt = post.title;
                }
            });
        }

        document.getElementById("editButton").addEventListener("click", () => {
          window.location.href = `/edit.html?id=${postId}`; // edit.htmlë¡œ ì´ë™
        });

        document
          .getElementById("deleteButton")
          .addEventListener("click", () => {
            document.getElementById("deleteModal").style.display = "block";
          });

        document
          .getElementById("confirmDeleteButton")
          .addEventListener("click", () => {
            fetch(`/api/posts/${postId}`, {
              method: "DELETE",
            })
              .then((res) => res.json())
              .then(() => {
                alert("ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.");
                closeModal("deleteModal");
                window.parent.location.reload(); // ìˆ˜ì •: ë¶€ëª¨ í˜ì´ì§€ ìƒˆë¡œê³ ì¹¨
              });
          });
        // ESC í‚¤ë¡œ ëª¨ë‹¬ ë‹«ê¸°
        document.addEventListener("keydown", function (event) {
          if (event.key === "Escape") {
            window.parent.postMessage("closeModal", "*");
          }
        });
      });

      function closeModal(modalId) {
        document.getElementById(modalId).style.display = "none";
      }
    </script>
  </body>
</html>
